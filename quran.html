<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Al-Quran Digital</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;family=Scheherazade+New:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body, #app {
      height: 100%;
      width: 100%;
    }
    
    .arabic-text {
      font-family: 'Scheherazade New', 'Amiri', serif;
      direction: rtl;
      text-align: right;
      line-height: 2.5;
      font-size: 32px;
    }
    
    .loading {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #6b7280;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .surah-item {
      padding: 14px 16px;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .surah-item:hover {
      background-color: #f9fafb;
    }

    .surah-item.active {
      background-color: #e5e7eb;
      border-left: 3px solid #374151;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background-color: #1f2937;
      color: white;
      padding: 14px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .arabic-text {
        font-size: 26px;
        line-height: 2.2;
      }

      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        width: 280px;
        z-index: 50;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        background-color: white;
        box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.5);
        z-index: 40;
        display: none;
      }

      .overlay.show {
        display: block;
      }

      .toast {
        bottom: 16px;
        right: 16px;
        left: 16px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full"></div>
  <script>
    let allSurahs = [];
    let currentSurah = 1;
    let surahData = null;
    let showTranslation = false;

    async function loadSurahs() {
      try {
        const response = await fetch('https://equran.id/api/v2/surat');
        const data = await response.json();
        allSurahs = data.data;
      } catch (error) {
        showToast('Gagal memuat daftar surah');
      }
    }

    async function loadSurah(surahNum) {
      try {
        currentSurah = surahNum;
        
        const response = await fetch(`https://equran.id/api/v2/surat/${surahNum}`);
        const data = await response.json();
        
        surahData = {
          info: data.data,
          ayahs: data.data.ayat.map(a => ({
            ...a,
            numberInSurah: a.nomorAyat,
            text: a.teksArab,
            translation: a.teksIndonesia
          }))
        };
        
        render();
      } catch (error) {
        showToast('Gagal memuat surah');
      }
    }

    async function goToSurah(surahNum) {
      await loadSurah(surahNum);
      closeSidebar();
    }

    function prevSurah() {
      if (currentSurah > 1) {
        loadSurah(currentSurah - 1);
      }
    }

    function nextSurah() {
      if (currentSurah < 114) {
        loadSurah(currentSurah + 1);
      }
    }

    function showToast(message) {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.remove(), 3000);
    }

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.overlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('show');
    }

    function closeSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.overlay');
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
    }

    function filterSurahs(query) {
      const items = document.querySelectorAll('.surah-item');
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(query.toLowerCase()) ? 'block' : 'none';
      });
    }

    function render() {
      const app = document.getElementById('app');
      
      if (!surahData) {
        app.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%;">
            <div class="loading"></div>
          </div>
        `;
        return;
      }

      const info = surahData.info;
      
      let surahListHTML = allSurahs.map(s => `
        <div class="surah-item ${s.nomor === currentSurah ? 'active' : ''}" onclick="goToSurah(${s.nomor})">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-weight: 600; color: #111827; font-size: 14px;">${s.nomor}. ${s.namaLatin}</div>
              <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">${s.arti} • ${s.jumlahAyat} ayat</div>
            </div>
            <div style="font-family: 'Amiri', serif; font-size: 20px; color: #374151;">${s.nama}</div>
          </div>
        </div>
      `).join('');

      let bismillahHTML = '';
      if (currentSurah !== 1 && currentSurah !== 9) {
        bismillahHTML = `
          <div class="arabic-text" style="text-align: center; color: #374151; margin-bottom: 24px; padding: 20px; background-color: white; font-size: 28px; border-bottom: 1px solid #e5e7eb;">
            بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ
          </div>
        `;
      }

      let ayahsHTML = surahData.ayahs.map((ayah, idx) => {
        let text = ayah.text;
        
        if (idx === 0 && currentSurah !== 1 && currentSurah !== 9) {
          const bismillahPattern = /^بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ\s*/;
          text = text.replace(bismillahPattern, '').trim();
        }

        const audioUrl = ayah.audio ? ayah.audio['05'] : '';
        
        // Convert number to Arabic-Indic digits for mushaf style
        const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
        const ayahNumberArabic = String(ayah.numberInSurah).split('').map(d => arabicNumbers[parseInt(d)]).join('');

        return `
          <div style="margin-bottom: 16px; padding: 16px; background-color: white; border-bottom: 1px solid #e5e7eb;">
            <div class="arabic-text" style="color: #111827; margin-bottom: 12px; text-align: justify;">
              ${text} <span style="display: inline-block; font-size: 28px; margin: 0 8px; color: #6b7280; position: relative; top: 2px;">۝${ayahNumberArabic}</span>
            </div>
            ${showTranslation && ayah.translation ? `
              <div style="color: #4b5563; font-size: 14px; line-height: 1.7; margin-bottom: 12px; text-align: justify;">
                ${ayah.translation}
              </div>
            ` : ''}
            <div style="display: flex; gap: 8px; margin-top: 12px;">
              <button onclick="copyAyah(${ayah.numberInSurah}, \`${text.replace(/`/g, '\\`')}\`, \`${ayah.translation ? ayah.translation.replace(/`/g, '\\`') : ''}\`)" style="padding: 6px 12px; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; display: flex; align-items: center; gap: 6px; cursor: pointer; color: #374151; font-size: 13px;" title="Salin ayat">
                <i class="fas fa-copy" style="font-size: 11px;"></i>
                <span>Salin</span>
              </button>
              ${audioUrl ? `
                <button onclick="playAudio('${audioUrl}')" style="padding: 6px 12px; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; display: flex; align-items: center; gap: 6px; cursor: pointer; color: #374151; font-size: 13px;" title="Putar audio">
                  <i class="fas fa-play" style="font-size: 11px;"></i>
                  <span>Putar</span>
                </button>
              ` : ''}
            </div>
          </div>
        `;
      }).join('');

      app.innerHTML = `
        <div style="display: flex; height: 100%; width: 100%;">
          <div class="overlay" onclick="closeSidebar()"></div>
          
          <!-- Sidebar -->
          <div class="sidebar" style="width: 320px; background-color: white; border-right: 1px solid #e5e7eb; overflow-y: auto; display: flex; flex-direction: column;">
            <div style="padding: 20px; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; background-color: white; z-index: 10;">
              <h2 style="font-size: 18px; font-weight: 600; color: #111827; margin: 0 0 12px 0;">Daftar Surah</h2>
              <input 
                type="text" 
                placeholder="Cari surah..."
                oninput="filterSurahs(this.value)"
                style="width: 100%; padding: 10px 14px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; outline: none;"
              >
            </div>
            <div style="flex: 1; overflow-y: auto;">
              ${surahListHTML}
            </div>
          </div>

          <!-- Main Content -->
          <div style="flex: 1; overflow-y: auto; background-color: #f9fafb;">
            <!-- Mobile Header -->
            <div style="display: none; padding: 16px; background-color: white; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 20;" class="mobile-header">
              <div style="display: flex; align-items: center; justify-content: space-between;">
                <button onclick="toggleSidebar()" style="background: none; border: none; cursor: pointer; font-size: 20px; color: #374151; padding: 8px;">
                  <i class="fas fa-bars"></i>
                </button>
                <h1 style="font-size: 16px; font-weight: 600; color: #111827; margin: 0;">${info.namaLatin}</h1>
                <div style="width: 36px;"></div>
              </div>
            </div>

            <div style="max-width: 900px; margin: 0 auto; padding: 32px 24px;">
              <!-- Header -->
              <div style="padding: 20px; background-color: white; border-bottom: 1px solid #e5e7eb; margin-bottom: 24px;">
                <h1 style="font-size: 20px; font-weight: 600; margin: 0 0 4px 0; color: #111827;">${info.namaLatin}</h1>
                <p style="font-size: 13px; margin: 0 0 12px 0; color: #6b7280;">
                  ${info.arti} • ${info.jumlahAyat} ayat • ${info.tempatTurun}
                </p>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                  <button 
                    onclick="showTranslation = !showTranslation; render();"
                    style="background-color: #f3f4f6; border: 1px solid #d1d5db; color: #374151; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px;">
                    ${showTranslation ? 'Sembunyikan' : 'Tampilkan'} Terjemahan
                  </button>
                  ${info.audioFull && info.audioFull['05'] ? `
                    <button 
                      id="fullAudioBtn"
                      onclick="toggleFullAudio('${info.audioFull['05']}')"
                      style="background-color: #6b7280; border: 1px solid #4b5563; color: white; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px;">
                      <i class="fas fa-play" style="font-size: 11px;"></i>
                      Putar Full Surah
                    </button>
                  ` : ''}
                </div>
              </div>

              <!-- Bismillah -->
              ${bismillahHTML}

              <!-- Ayahs -->
              ${ayahsHTML}

              <!-- Footer Navigation -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 24px; padding: 16px; background-color: white; border-top: 1px solid #e5e7eb;">
                <button 
                  onclick="nextSurah()"
                  style="padding: 8px 16px; background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 13px;"
                  ${currentSurah >= 114 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                  Surah Selanjutnya →
                </button>
                <div style="font-size: 13px; color: #6b7280;">
                  ${currentSurah} / 114
                </div>
                <button 
                  onclick="prevSurah()"
                  style="padding: 8px 16px; background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 13px;"
                  ${currentSurah <= 1 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                  ← Surah Sebelumnya
                </button>
              </div>
            </div>
          </div>
        </div>

        <style>
          @media (max-width: 768px) {
            .mobile-header {
              display: block !important;
            }
          }
        </style>
      `;
    }

    let currentAudio = null;
    let fullAudio = null;
    let isPlayingFull = false;

    function playAudio(url) {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }
      
      if (fullAudio) {
        fullAudio.pause();
        fullAudio = null;
        isPlayingFull = false;
        updateFullAudioButton();
      }
      
      currentAudio = new Audio(url);
      currentAudio.play().catch(err => {
        showToast('Gagal memutar audio');
      });
    }

    function toggleFullAudio(url) {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }

      if (fullAudio && isPlayingFull) {
        fullAudio.pause();
        fullAudio = null;
        isPlayingFull = false;
        updateFullAudioButton();
        return;
      }

      if (!fullAudio || fullAudio.src !== url) {
        fullAudio = new Audio(url);
        fullAudio.addEventListener('ended', () => {
          isPlayingFull = false;
          updateFullAudioButton();
        });
      }

      fullAudio.play().then(() => {
        isPlayingFull = true;
        updateFullAudioButton();
      }).catch(err => {
        showToast('Gagal memutar audio full');
        isPlayingFull = false;
        updateFullAudioButton();
      });
    }

    function updateFullAudioButton() {
      const btn = document.getElementById('fullAudioBtn');
      if (btn) {
        if (isPlayingFull) {
          btn.innerHTML = '<i class="fas fa-pause" style="font-size: 11px;"></i> Pause Full Surah';
          btn.style.backgroundColor = '#374151';
        } else {
          btn.innerHTML = '<i class="fas fa-play" style="font-size: 11px;"></i> Putar Full Surah';
          btn.style.backgroundColor = '#6b7280';
        }
      }
    }

    function copyAyah(ayahNumber, arabicText, translation) {
      const surahName = surahData.info.namaLatin;
      const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
      const ayahNumberArabic = String(ayahNumber).split('').map(d => arabicNumbers[parseInt(d)]).join('');
      
      let textToCopy = `${arabicText} ۝${ayahNumberArabic}\n`;
      
      if (showTranslation && translation) {
        textToCopy += `\n${translation}\n`;
      }
      
      textToCopy += `\n(QS. ${surahName}: ${ayahNumber})`;
      
      // Fallback for browsers that don't support clipboard API
      const textArea = document.createElement('textarea');
      textArea.value = textToCopy;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        const successful = document.execCommand('copy');
        document.body.removeChild(textArea);
        if (successful) {
          showToast('Ayat berhasil disalin!');
        } else {
          showToast('Gagal menyalin ayat');
        }
      } catch (err) {
        document.body.removeChild(textArea);
        showToast('Gagal menyalin ayat');
      }
    }

    window.goToSurah = goToSurah;
    window.prevSurah = prevSurah;
    window.nextSurah = nextSurah;
    window.toggleSidebar = toggleSidebar;
    window.closeSidebar = closeSidebar;
    window.filterSurahs = filterSurahs;
    window.playAudio = playAudio;
    window.toggleFullAudio = toggleFullAudio;
    window.copyAyah = copyAyah;

    async function init() {
      await loadSurahs();
      await loadSurah(1);
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9add506512dafdc7',t:'MTc2NTcxMTI0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
