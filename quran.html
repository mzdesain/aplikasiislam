<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Al-Quran Digital</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&amp;family=Scheherazade+New:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }
    
    .arabic-text {
      font-family: 'Amiri Quran', 'Scheherazade New', serif;
      direction: rtl;
      text-align: right;
      line-height: 2;
    }
    
    .loading-spinner {
      border: 3px solid rgba(38, 75, 119, 0.2);
      border-radius: 50%;
      border-top: 3px solid #264b77;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .surah-item {
      transition: all 0.2s;
      cursor: pointer;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .surah-item:hover {
      background-color: #f9fafb;
    }

    .ayah-container {
      border-bottom: 1px solid #e5e7eb;
      padding: 24px 0;
    }

    .ayah-number {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #264b77;
      color: white;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
    }

    .play-icon {
      cursor: pointer;
      transition: all 0.2s;
      color: #264b77;
    }

    .play-icon:hover {
      transform: scale(1.1);
      color: #1a3350;
    }

    .action-button {
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.2s;
      color: #6b7280;
    }

    .action-button:hover {
      background-color: #f3f4f6;
      color: #264b77;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      background-color: #264b77;
      color: white;
      font-size: 14px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .bismillah {
      font-family: 'Amiri Quran', serif;
      font-size: 28px;
      text-align: center;
      color: #264b77;
      padding: 30px 0;
    }

    .sidebar {
      width: 320px;
      border-right: 1px solid #e5e7eb;
      overflow-y: auto;
      background-color: white;
      transition: transform 0.3s ease;
    }

    .content-area {
      flex: 1;
      overflow-y: auto;
      background-color: #fafafa;
    }

    .search-box {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 10;
      border-bottom: 1px solid #e5e7eb;
    }

    .mobile-header {
      display: none;
      position: sticky;
      top: 0;
      z-index: 20;
      background-color: white;
      color: #264b77;
      padding: 16px 20px;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .hamburger-btn {
      cursor: pointer;
      padding: 8px;
      background: none;
      border: none;
      color: #264b77;
      font-size: 20px;
    }

    @media (max-width: 768px) {
      .mobile-header {
        display: flex;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        width: 85%;
        max-width: 320px;
        z-index: 30;
        transform: translateX(-100%);
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }

      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 25;
        display: none;
      }

      .sidebar-overlay.active {
        display: block;
      }
      
      .desktop-layout {
        flex-direction: column;
        padding-top: 0;
      }

      .content-area {
        width: 100%;
      }

      .ayah-container {
        padding: 16px 0 !important;
      }

      .bismillah {
        font-size: 22px !important;
        padding: 20px 10px !important;
      }

      .surah-item {
        padding: 14px 16px !important;
        gap: 12px !important;
      }

      .surah-item .ayah-number {
        width: 36px !important;
        height: 36px !important;
        font-size: 14px !important;
      }

      .action-button {
        padding: 10px !important;
        font-size: 16px;
      }

      .toast {
        bottom: 10px;
        right: 10px;
        left: 10px;
        font-size: 13px;
        padding: 10px 16px;
      }
    }

    @media (max-width: 480px) {
      .surah-item {
        padding: 12px 14px !important;
        gap: 10px !important;
      }

      .surah-item .ayah-number {
        width: 34px !important;
        height: 34px !important;
        font-size: 13px !important;
      }

      .ayah-number {
        width: 30px !important;
        height: 30px !important;
        font-size: 12px !important;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full"></div>
  <script>
    let surahList = [];
    let currentSurah = null;
    let selectedSurahNumber = null;
    let filteredSurahList = [];
    let audioElement = null;
    let isPlayingFullSurah = false;
    let currentAyahIndex = 0;

    async function fetchSurahList() {
      try {
        const response = await fetch('https://equran.id/api/v2/surat');
        const result = await response.json();
        
        // Transform data to match expected format
        surahList = result.data.map((surah) => ({
          nomor: surah.nomor,
          nama: surah.nama,
          nama_latin: surah.namaLatin,
          arti: surah.arti,
          jumlah_ayat: surah.jumlahAyat,
          tempat_turun: surah.tempatTurun
        }));
        
        filteredSurahList = surahList;
        return surahList;
      } catch (error) {
        console.error('Error:', error);
        return [];
      }
    }

    async function fetchSurah(number) {
      try {
        const response = await fetch(`https://equran.id/api/v2/surat/${number}`);
        const result = await response.json();
        const data = result.data;
        
        currentSurah = {
          nomor: data.nomor,
          nama: data.nama,
          nama_latin: data.namaLatin,
          arti: data.arti,
          jumlah_ayat: data.jumlahAyat,
          tempat_turun: data.tempatTurun,
          deskripsi: data.deskripsi,
          ayat: data.ayat.map(ayah => ({
            nomorAyat: ayah.nomorAyat,
            teksArab: ayah.teksArab,
            teksIndonesia: ayah.teksIndonesia,
            teksLatin: ayah.teksLatin || '',
            audio: ayah.audio ? ayah.audio['05'] : null
          }))
        };
        
        return currentSurah;
      } catch (error) {
        console.error('Error:', error);
        return null;
      }
    }



    function copyAyah(text) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          showToast('Ayat berhasil disalin');
        }).catch(() => {
          showToast('Gagal menyalin ayat');
        });
      } else {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showToast('Ayat berhasil disalin');
        } catch (err) {
          showToast('Gagal menyalin ayat');
        }
        document.body.removeChild(textArea);
      }
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 2000);
    }

    function playAudio(audioUrl) {
      if (audioElement) {
        audioElement.pause();
      }
      isPlayingFullSurah = false;
      audioElement = new Audio(audioUrl);
      audioElement.play();
      showToast('Memutar audio...');
    }

    function playFullSurah() {
      if (!currentSurah || !currentSurah.ayat || currentSurah.ayat.length === 0) {
        showToast('Tidak ada audio tersedia');
        return;
      }

      const playBtn = document.getElementById('play-full-btn');
      const playIcon = document.getElementById('play-icon');
      const playText = document.getElementById('play-text');

      if (isPlayingFullSurah && audioElement && !audioElement.paused) {
        // Stop playing
        audioElement.pause();
        isPlayingFullSurah = false;
        playIcon.className = 'fas fa-play';
        playText.textContent = 'Putar Full Surah';
        showToast('Audio dihentikan');
        return;
      }

      // Start playing from beginning
      isPlayingFullSurah = true;
      currentAyahIndex = 0;
      playIcon.className = 'fas fa-pause';
      playText.textContent = 'Hentikan Audio';
      playNextAyah();
    }

    function playNextAyah() {
      if (!isPlayingFullSurah || currentAyahIndex >= currentSurah.ayat.length) {
        // Finished playing all ayahs
        isPlayingFullSurah = false;
        const playIcon = document.getElementById('play-icon');
        const playText = document.getElementById('play-text');
        if (playIcon && playText) {
          playIcon.className = 'fas fa-play';
          playText.textContent = 'Putar Full Surah';
        }
        if (currentAyahIndex >= currentSurah.ayat.length) {
          showToast('Selesai memutar surah');
        }
        return;
      }

      const ayah = currentSurah.ayat[currentAyahIndex];
      
      if (!ayah.audio) {
        // Skip to next if no audio
        currentAyahIndex++;
        playNextAyah();
        return;
      }

      // Highlight current ayah
      const allAyahs = document.querySelectorAll('.ayah-container');
      allAyahs.forEach(el => el.style.backgroundColor = '');
      const currentAyahElement = document.getElementById(`ayah-${ayah.nomorAyat}`);
      if (currentAyahElement) {
        currentAyahElement.style.backgroundColor = '#e0f2fe';
        currentAyahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      if (audioElement) {
        audioElement.pause();
      }

      audioElement = new Audio(ayah.audio);
      
      audioElement.onended = () => {
        if (currentAyahElement) {
          currentAyahElement.style.backgroundColor = '';
        }
        currentAyahIndex++;
        playNextAyah();
      };

      audioElement.onerror = () => {
        currentAyahIndex++;
        playNextAyah();
      };

      audioElement.play();
      showToast(`Memutar ayat ${ayah.nomorAyat} dari ${currentSurah.jumlah_ayat}`);
    }

    async function selectSurah(number) {
      selectedSurahNumber = number;
      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = '<div class="flex items-center justify-center h-full"><div class="loading-spinner"></div></div>';
      
      // Close sidebar on mobile
      if (window.innerWidth <= 768) {
        toggleSidebar();
      }
      
      await fetchSurah(number);
      renderContent();
      renderSidebar();
    }

    function renderSidebar() {
      const sidebar = document.getElementById('sidebar');
      
      sidebar.innerHTML = `
        <div class="search-box p-4">
          <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 13px; color: #6b7280; margin-bottom: 6px; font-weight: 500;">Pilih Surah</label>
            <select 
              id="surah-select"
              onchange="selectSurah(parseInt(this.value))"
              style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; outline: none; background-color: white; cursor: pointer;"
            >
              <option value="">-- Pilih Surah --</option>
              ${surahList.map(surah => `
                <option value="${surah.nomor}" ${selectedSurahNumber === surah.nomor ? 'selected' : ''}>
                  ${surah.nomor}. ${surah.nama_latin} (${surah.nama})
                </option>
              `).join('')}
            </select>
          </div>
          ${currentSurah ? `
          <div style="margin-bottom: 12px;">
            <label style="display: block; font-size: 13px; color: #6b7280; margin-bottom: 6px; font-weight: 500;">Pilih Ayat</label>
            <select 
              id="ayah-select"
              onchange="scrollToAyah(parseInt(this.value))"
              style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; outline: none; background-color: white; cursor: pointer;"
            >
              <option value="">-- Pilih Ayat --</option>
              ${currentSurah.ayat.map(ayah => `
                <option value="${ayah.nomorAyat}">Ayat ${ayah.nomorAyat}</option>
              `).join('')}
            </select>
          </div>
          ` : ''}
        </div>
        <div style="padding: 8px 0;">
          ${filteredSurahList.map(surah => `
            <div class="surah-item ${selectedSurahNumber === surah.nomor ? 'bg-blue-50' : ''}" onclick="selectSurah(${surah.nomor})" style="padding: 16px 20px; display: flex; align-items: center; gap: 16px;">
              <div class="ayah-number" style="width: 40px; height: 40px; font-size: 16px;">
                ${surah.nomor}
              </div>
              <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 600; color: #111827; margin-bottom: 2px;">${surah.nama_latin}</div>
                <div style="font-size: 13px; color: #6b7280;">${surah.tempat_turun} • ${surah.jumlah_ayat} Ayat</div>
              </div>
              <div class="arabic-text" style="font-size: 18px; color: #264b77; font-weight: 600;">
                ${surah.nama}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderContent() {
      const contentArea = document.getElementById('content-area');
      
      if (!currentSurah) {
        contentArea.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #9ca3af;">
            <div style="text-align: center;">
              <i class="" style="font-size: 64px; margin-bottom: 16px;"></i>
              <p style="font-size: 18px;"></p>
            </div>
          </div>
        `;
        return;
      }

      const showBismillah = currentSurah.nomor !== 1 && currentSurah.nomor !== 9;

      contentArea.innerHTML = `
        <div style="max-width: 900px; margin: 0 auto; padding: 0;">
          <!-- Header Surah -->
          <div style="background: linear-gradient(135deg, #264b77 0%, #1a3350 100%); padding: 32px 20px; text-align: center; color: white;">
            <h1 style="font-size: clamp(24px, 5vw, 32px); font-weight: 700; margin-bottom: 8px;">${currentSurah.nama_latin}</h1>
            <p style="font-size: clamp(16px, 3vw, 18px); margin-bottom: 12px; opacity: 0.95;">${currentSurah.arti}</p>
            <div style="font-size: clamp(13px, 2.5vw, 14px); opacity: 0.9; margin-bottom: 16px;">
              ${currentSurah.tempat_turun} • ${currentSurah.jumlah_ayat} Ayat
            </div>
            <button 
              onclick="playFullSurah()" 
              id="play-full-btn"
              style="background-color: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white; padding: 12px 24px; border-radius: 8px; font-size: clamp(13px, 2.5vw, 14px); cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; font-weight: 500;"
              onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.3)'" 
              onmouseout="this.style.backgroundColor='rgba(255, 255, 255, 0.2)'"
            >
              <i class="fas fa-play" id="play-icon" style="font-size: 14px;"></i>
              <span id="play-text">Putar Full Surah</span>
            </button>
          </div>

          <!-- Bismillah -->
          ${showBismillah ? '<div class="bismillah" style="background-color: white; margin: 0;">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>' : ''}

          <!-- Ayat List -->
          <div style="background-color: white; padding: 20px 16px;">
            ${currentSurah.ayat.map((ayah) => `
              <div class="ayah-container" id="ayah-${ayah.nomorAyat}">
                <!-- Ayah Header -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                  <div class="ayah-number">${ayah.nomorAyat}</div>
                  <div style="display: flex; gap: 8px;">
                    ${ayah.audio ? `<div class="action-button" onclick="playAudio('${ayah.audio}')"><i class="fas fa-play"></i></div>` : ''}
                    <div class="action-button" onclick="copyAyah(\`${ayah.teksArab}\`)"><i class="fas fa-copy"></i></div>
                  </div>
                </div>

                <!-- Arabic Text -->
                <div class="arabic-text" style="font-size: clamp(22px, 4vw, 28px); color: #111827; margin-bottom: 16px; line-height: 2.2;">
                  ${ayah.teksArab}
                </div>

                <!-- Translation -->
                <div style="color: #374151; font-size: clamp(14px, 2.5vw, 16px); line-height: 1.7; margin-bottom: 8px;">
                  ${ayah.teksIndonesia}
                </div>


              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderApp() {
      const app = document.getElementById('app');
      
      // Always show app directly
      app.innerHTML = `
        <div style="height: 100%; width: 100%;">
          <div class="mobile-header">
            <button class="hamburger-btn" onclick="toggleSidebar()">
              <i class="fas fa-bars"></i>
            </button>
            <h1 style="font-size: 18px; font-weight: 600; margin: 0;">Al-Quran Digital</h1>
            <div style="width: 40px;"></div>
          </div>
          <div class="desktop-layout" style="display: flex; height: 100%; width: 100%;">
            <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
            <div id="sidebar" class="sidebar"></div>
            <div id="content-area" class="content-area"></div>
          </div>
        </div>
      `;

      renderSidebar();
      renderContent();
    }
    
    function hideSplash() {
      renderApp();
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    }

    function scrollToAyah(ayahNumber) {
      if (!ayahNumber) return;
      
      const ayahElement = document.getElementById(`ayah-${ayahNumber}`);
      if (ayahElement) {
        ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // Highlight effect
        ayahElement.style.backgroundColor = '#e0f2fe';
        setTimeout(() => {
          ayahElement.style.backgroundColor = '';
        }, 2000);
        showToast(`Menuju ayat ${ayahNumber}`);
      }
    }

    window.selectSurah = selectSurah;
    window.playAudio = playAudio;
    window.copyAyah = copyAyah;
    window.scrollToAyah = scrollToAyah;
    window.toggleSidebar = toggleSidebar;
    window.playFullSurah = playFullSurah;
    window.hideSplash = hideSplash;

    async function initialize() {
      const app = document.getElementById('app');
      app.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%;"><div class="loading-spinner"></div></div>';
      
      await fetchSurahList();
      renderApp();
    }

    initialize();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9adace3601578a13',t:'MTc2NTY4NDk0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
